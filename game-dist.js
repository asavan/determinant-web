"use strict";function game(t,e,s){const n=function(){let t=-1,e=-1;const s=t=>t%2==0,n=function(t,e,i,o,l){if(9===i)return(c=t)[0]*c[4]*c[8]+c[6]*c[1]*c[5]+c[3]*c[7]*c[2]-c[2]*c[4]*c[6]-c[1]*c[3]*c[8]-c[0]*c[5]*c[7];var c;let r=0;for(let c=0;c<9;++c)if(!e[c]){if(++r,2===r&&7===i)break;e[c]=!0;for(let r=0;r<9;++r){if(0!==t[r])continue;t[r]=c+1;const a=n(t,e,i+1,o,l);if(s(i)?l<a&&(l=a):o>a&&(o=a),t[r]=0,!s(i)&&a<=l||s(i)&&a>=o)return e[c]=!1,a}e[c]=!1}return s(i)?l:o};function i(t,e){let s=0;for(let n=0;n<9;++n){const i=t[n];if(i>0){++s,e[i-1]=!0}}return s}return{solve_matrix_flat:function(o){const l=[];((t,e)=>{for(let s=0;s<9;++s)e[s]=t[s]})(o,l);const c=[];let r=i(l,c),a=500,d=-500;const u=s(r);if(9===r&&(a=n(l,c,r,a,d),t=-1,e=-1),0===r)return d=40,t=4,e=((t,e)=>{let s=t+Math.random()*(e-t);return Math.floor(s)})(0,9),{result:d,bestK:t,bestPos:e};for(let s=0;s<9;++s){if(c[s])continue;c[s]=!0;const i=1===r?6:9;for(let o=0;o<i;++o){if(0!==l[o])continue;let i=!1;l[o]=s+1;const f=n(l,c,r+1,a,d);u?d<f&&(d=f,i=!0):a>f&&(a=f,i=!0),i&&(e=o,t=s),l[o]=0}c[s]=!1}return{result:u?d:a,bestK:t,bestPos:e}},fill_digits:i,isFirstStep:s}}(),i=function(t){let e=-1,s=-1,o=-1,l=-1,c=-1,r=-1,a=0,d=-1;const u=[0,0,0,0,0,0,0,0,0],f=[!1,!1,!1,!1,!1,!1,!1,!1,!1],g=[!1,!1,!1,!1,!1,!1,!1,!1,!1];return{matrix_result:u,player_moves:f,comp_moves:g,getLastCompMove:()=>o,getLastUserMove:()=>l,makeMove:function(){console.time("stepTime");const n=t.solve_matrix_flat(u);console.timeEnd("stepTime"),console.log(n.result),a=n.result,r=n.bestPos,c=n.bestK,r>=0&&(u[r]=c+1,g[r]=!0,o=r),e=-1,s=-1},getResult:()=>a,setUserMove:function(t,n){u[t]=n+1,f[t]=!0,l=t,e=-1,s=-1},getActiveDigitIndex:()=>s,setActiveDigitIndex:function(t){if(d=-1,t>=0){const e=[];if(d=n.fill_digits(i.matrix_result,e),e[t])return void(s=-1)}s=t},getActivePosition:()=>e,setActivePosition:function(t){e=t>=0&&u[t]>0?-1:t},getStep:()=>d}}(n),o=function(t,e){if(t.preventDefault(),t.target.classList.contains("cell")||t.target.classList.contains("digit"))return function(t,e){const s=t.target||t.srcElement;for(let t=0;t<e.children.length;t++)if(e.children[t]===s)return t;return-1}(t,e)};function l(){i.getActivePosition()>=0&&i.getActiveDigitIndex()>=0&&(i.setUserMove(i.getActivePosition(),i.getActiveDigitIndex()),c(),setTimeout((function(){if(i.makeMove(),c(),i.getStep()>5){const t=i.getResult()>0&&n.isFirstStep(i.getStep())?"You win":"You lose";d.querySelectorAll("h2")[0].textContent=t,d.querySelectorAll(".content")[0].textContent="Result "+i.getResult(),d.classList.add("show")}}),500)),c()}function c(){!function(){const t=[];for(let t=0;t<9;t++){const e=r.childNodes[t],s=i.matrix_result[t];e.textContent=s.toString(),e.className=s?"cell disabled":"cell hole",i.getActivePosition()===t&&e.classList.add("active"),i.comp_moves[t]&&e.classList.add("comp"),i.player_moves[t]&&e.classList.add("player"),t!==i.getLastUserMove()&&t!==i.getLastCompMove()||e.classList.add("last")}n.fill_digits(i.matrix_result,t);for(let e=0;e<9;e++){const s=a.childNodes[e],n=t[e],o=e+1;s.textContent=o.toString(),s.className="digit",n&&s.classList.add("disabled"),i.getActiveDigitIndex()===e&&s.classList.add("active"),e===i.matrix_result[i.getLastCompMove()]-1&&s.classList.add("comp"),e===i.matrix_result[i.getLastUserMove()]-1&&s.classList.add("player")}}()}const r=e.getElementsByClassName("box")[0],a=e.getElementsByClassName("digits")[0],d=e.getElementsByClassName("overlay")[0],u=e.getElementsByClassName("close")[0];for(let t=0;t<9;t++){const t=e.createElement("div");t.className="cell",r.appendChild(t)}for(let t=0;t<9;t++){const t=e.createElement("div");t.className="cell",a.appendChild(t)}!function(){const t=e.createElement("canvas"),s=e.getElementById("favicon");s||console.error("Can't find favicon"),t.height=t.width=16;const n=t.getContext("2d");n.fillStyle="#000"}();r.addEventListener("click",(function(t){i.setActivePosition(o(t,r)),l()}),!1),a.addEventListener("click",(function(t){i.setActiveDigitIndex(o(t,a)),l()}),!1),u.addEventListener("click",(function(t){t.preventDefault(),d.classList.remove("show")}),!1),s&&i.makeMove(),c()}function install(t,e){const s=e.getElementById("butInstall");let n;s.addEventListener("click",t=>{s.classList.add("hidden"),n.prompt(),n.userChoice.then(t=>{console.log(JSON.stringify(t))})}),t.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),n=t,s.classList.remove("hidden")})}!function(t,e){try{const s=t.location.search,n=new URLSearchParams(s),i=!!n.get("startRed")&&!!JSON.parse(n.get("startRed"));"serviceWorker"in navigator&&(navigator.serviceWorker.register("./sw.js",{scope:"./"}),install(t,e)),game(t,e,i)}catch(t){console.log(t)}}(window,document);