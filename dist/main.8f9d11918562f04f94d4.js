!function(t){var e={};function n(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(r,s,function(e){return t[e]}.bind(null,s));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="./dist/",n(n.s=1)}([function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(0);var r={modes:["net","fake","ai","hotseat"],currentMode:"ai",debug:!0,wsPort:8088,negotiatedId:3,startRed:!1,size:3};const s=function(t,e){let n=e.startRed,r=-1,s=-1,i=-1,o=-1,l=-1,a=-1,c=0,u=0;const d=Array(t.getSizeSqr()).fill(0),f=Array(t.getSizeSqr()).fill(!1),g=Array(t.getSizeSqr()).fill(!1),m=Array(t.getSizeSqr()).fill(!1);const v=()=>c,p=function(e,l){const a=function(e,n,l){return!(e<0)&&(!(n<0)&&(0===d[e]&&(d[e]=n+1,l?(g[e]=!0,i=e):(f[e]=!0,o=e),u=t.fill_digits(d,m),r=-1,s=-1,!0)))}(e,l,n);return a&&(n=!n),a},_=()=>s,y=()=>r;return{matrix_result:d,player_moves:f,comp_moves:g,getLastCompMove:()=>i,getLastUserMove:()=>o,isLastMove:t=>i===t||o===t,getResult:v,getActiveDigitIndex:_,setActiveDigitIndex:function(t){n&&"hotseat"!==e.currentMode||(s=t>=0&&m[t]?-1:t)},getActivePosition:y,setActivePosition:function(t){n&&"hotseat"!==e.currentMode||(r=t>=0&&d[t]>0?-1:t)},onAiMove:function(t){return c=t.result,a=t.bestPos,l=t.bestK,p(a,l)},getDigits:()=>m,getStep:()=>u,isWin:t=>v()>0!==t,lessThanTwoMoves:()=>u+2>d.length&&_()<0&&y()<0,tryMove:function(){return p(y(),_())}}};let i=null;function o(t,e){let n=-1,r=-1;const s=t=>t%2==0,i=function(n,r,o,l,a){if(o===t)return e.determinant(n);let c=0;for(let e=0;e<t;++e)if(!r[e]){if(++c,2===c&&o===t-2)break;r[e]=!0;for(let c=0;c<t;++c){if(0!==n[c])continue;n[c]=e+1;const t=i(n,r,o+1,l,a);if(s(o)?a<t&&(a=t):l>t&&(l=t),n[c]=0,!s(o)&&t<=a||s(o)&&t>=l)return r[e]=!1,t}r[e]=!1}return s(o)?a:l};return{solve_matrix_flat:function(o){const l=[];((e,n)=>{for(let r=0;r<t;++r)n[r]=e[r]})(o,l);const a=[];let c=e.fill_digits(l,a),u=500,d=-500;const f=s(c);c===t&&(u=i(l,a,c,u,d),n=-1,r=-1);for(let e=0;e<t;++e)if(!a[e]){a[e]=!0;for(let s=0;s<t;++s){if(0!==l[s])continue;let t=!1;l[s]=e+1;const o=i(l,a,c+1,u,d);f?d<o&&(d=o,t=!0):u>o&&(u=o,t=!0),t&&(r=s,n=e),l[s]=0}a[e]=!1}return{result:f?d:u,bestK:n,bestPos:r}}}}function l(t,e,n){let r=null;function s(t){e.onAiMove(t);const s=new Date;r&&s-r<700?setTimeout(n,700-(s-r)):n()}return i.addEventListener("message",(function(e){var n;n=e.data,s(t.int_to_result(n))}),!1),{makeMove:function(){let n=e.getStep();if(r=new Date,n===e.matrix_result.length){return s({result:t.determinant(e.matrix_result),bestK:-1,bestPos:-1}),r}if(0===n&&3===t.getSize()){return s({result:40,bestK:4,bestPos:((t,e)=>{let n=t+Math.random()*(e-t);return Math.floor(n)})(0,e.matrix_result.length)}),r}if(3===t.getSize()){const n=t.matrix_to_int(e.matrix_result);i.postMessage(n)}else if(2===t.getSize()){s(o(4,t).solve_matrix_flat(e.matrix_result))}return r}}}window.Worker&&(i=new Worker("worker.js"));const a=function(t,e){if(t.preventDefault(),t.target.classList.contains("cell")||t.target.classList.contains("digit"))return function(t,e){const n=t.target||t.srcElement;for(let t=0;t<e.children.length;t++)if(e.children[t]===n)return t;return-1}(t,e)};function c(t,e,n){const r=e.getElementsByClassName("box")[0],i=e.getElementsByClassName("digits")[0],o=e.getElementsByClassName("overlay")[0],c=e.getElementsByClassName("close")[0],u=e.getElementsByClassName("install")[0];if(3!==n.size){e.documentElement.style.setProperty("--field-size",n.size)}const d=n.startRed,f=function(t){const e=t*t;return{fill_digits:function(t,n){let r=0;for(let s=0;s<e;++s){const e=t[s];if(e>0){++r,n[e-1]=!0}}return r},matrix_to_int:function(t){let n=0;for(let r=0;r<e;++r)n*=10,n+=t[r];return n},int_to_result:function(t){const e=t<0?-1:1,n=(t*=e)%10;t-=n;const r=(t/=10)%10;t-=r;return{result:e*(t/=10),bestK:r,bestPos:n}},determinant:function(n){return 3===t?(t=>t[0]*t[4]*t[8]+t[6]*t[1]*t[5]+t[3]*t[7]*t[2]-t[2]*t[4]*t[6]-t[1]*t[3]*t[8]-t[0]*t[5]*t[7])(n):2===t?(t=>t[0]*t[3]-t[1]*t[2])(n):e},getSize:()=>t,getSizeSqr:()=>e}}(n.size),g=s(f,n),m=l(f,g,v);function v(){_(),g.lessThanTwoMoves()&&function(){const t=g.isWin(d)?"You win":"You lose";o.querySelectorAll("h2")[0].textContent=t,o.querySelectorAll(".content")[0].textContent="Determinant =  "+g.getResult(),o.classList.add("show"),u.classList.remove("hidden2")}()}function p(){const t=g.tryMove();v(),t&&m.makeMove()}function _(){!function(t,e,n){for(let n=0;n<t.matrix_result.length;n++){const r=e.childNodes[n],s=t.matrix_result[n];r.textContent=s.toString(),r.className=s?"cell disabled":"cell hole",t.getActivePosition()===n&&r.classList.add("active"),t.comp_moves[n]&&r.classList.add("comp"),t.player_moves[n]&&r.classList.add("player"),t.isLastMove(n)&&r.classList.add("last")}const r=t.getDigits();for(let e=0;e<t.matrix_result.length;e++){const s=n.childNodes[e],i=r[e],o=e+1;s.textContent=o.toString(),s.className="digit",i&&s.classList.add("disabled"),t.getActiveDigitIndex()===e&&s.classList.add("active"),e===t.matrix_result[t.getLastCompMove()]-1&&s.classList.add("comp"),e===t.matrix_result[t.getLastUserMove()]-1&&s.classList.add("player")}}(g,r,i)}function y(t,n,r){for(let s=0;s<t;s++){const t=e.createElement("div");t.className=n,r.appendChild(t)}}return y(g.matrix_result.length,"cell",r),y(g.matrix_result.length,"digit",i),r.addEventListener("click",(function(t){g.setActivePosition(a(t,r)),p()}),!1),i.addEventListener("click",(function(t){g.setActiveDigitIndex(a(t,i)),p()}),!1),c.addEventListener("click",(function(t){t.preventDefault(),o.classList.remove("show")}),!1),_(),d&&m.makeMove(),{guess:()=>m.makeMove()}}!function(t,e,n){"loading"!==n.readyState?t(e,n):n.addEventListener("DOMContentLoaded",(function(r){t(e,n)}))}((function(t,e){const n=t.location.search,s=new URLSearchParams(n),i=s.get("startRed")?!!JSON.parse(s.get("startRed")):r.startRed;r.startRed=i,r.size=s.get("size")?parseInt(s.get("size"),10):r.size,t.gameObj=c(0,e,r)}),window,document),"serviceWorker"in navigator&&(navigator.serviceWorker.register("./sw.js",{scope:"./"}),function(t,e){const n=e.querySelector(".butInstall");let r;n.addEventListener("click",t=>{n.classList.add("hidden"),r.prompt(),r.userChoice.then(t=>{})}),t.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),r=t,n.classList.remove("hidden")})}(window,document))}]);