"use strict";(self.webpackChunkdeterminant_web=self.webpackChunkdeterminant_web||[]).push([[92],{36:(n,e,t)=>{t.d(e,{Zk:()=>s,k6:()=>c});var o=t(420);function c(n){n&&n.remove()}function s(n,e,t="./images/sigma.svg"){const c=new URL(n);var s,r;return function(n,e,t){const c=new o.hp(n,{level:"M",padding:3,image:{source:t,width:"15%",height:"15%",x:"center",y:"center"}});var s;return e.innerHTML=c.toString(),(s=e).addEventListener("click",(()=>s.classList.toggle("big"))),e}((s=c.toString(),r="/",s.charAt(s.length-r.length)===r?s.substr(0,s.length-r.length):s),e,t)}},92:(n,e,t)=>{t.r(e),t.d(e,{default:()=>l});var o=t(684),c=t(969);function s(n,e){const t={method:e};return t[e]=n,JSON.stringify(t)}const r={parser:function(n,e,t){const o=JSON.parse(n),c=o[o.method];return o.method===e&&t(c),c},toMove:function(n){return s(n,"move")},toObjJson:s};const a=function(n){return{playerMove:n.aiMove}};var i=t(36);function l(n,e,t,s){return new Promise(((l,u)=>{const d=(0,c.B)(n.location,t);if(!d)return void u("No ws");const f=(0,o.A)(t),g=t.color,h=(0,c.Y)(n.location,t);f.on("socket_open",(()=>{const t=n.location.search,o=new URLSearchParams(t),c=new URL(h);c.search=o,c.searchParams.set("color",f.getOtherColor(g)),c.searchParams.set("mode","net");const s=(0,i.Zk)(c.toString(),e.querySelector(".qrcode"),"./images/sigma.svg");f.on("socket_close",(()=>{(0,i.k6)(s)}))}));try{f.connect(d)}catch(n){u(n)}f.on("open",(()=>{const o=s(n,e,t),c=a(o);f.on("recv",(n=>{for(const[e,t]of Object.entries(c))r.parser(n,e,t)}));for(const[n]of Object.entries(c))o.on(n,(e=>f.sendMessage(r.toObjJson(e,n))));l(o)}))}))}},684:(n,e,t)=>{t.d(e,{A:()=>i});const o=["blue","red"];function c(n){}let s="";const r={recv:c,open:c,socket_open:c,socket_close:c,close:c};function a(n){for(const e of o)if(n!==e)return e;return""}const i=function(n){const e="server"===n.mode;let t=null,o=!1;function i(n,e){t=n,t.onmessage=function(n){r.recv(n.data)},t.onopen=function(){o=!0,e.send("close",{}),e.close(),r.open()},t.onclose=function(){o=!1},t.onerror=function(){}}return{connect:function(o){const a=n.color,l=function(n,e,t){const o=new WebSocket(n),a=(n,t,c,s)=>{const r={from:e,to:c||"all",action:n,data:t,ignore:s};return o.send(JSON.stringify(r))},i={onmessage:c,send:a,close:()=>{o.close()}};return o.onopen=function(n){r.socket_open(),s=e,t||a("connected",{color:e})},o.onclose=function(n){r.socket_close()},o.onmessage=async function(n){if(n.data instanceof Blob){const e=await n.data.text();return i.onmessage(e)}return i.onmessage(n.data)},o.onerror=function(n){},i}(o,a,e),u=new RTCPeerConnection;u.onicecandidate=function(n){n&&l.send("candidate",n.candidate)},u.oniceconnectionstatechange=()=>{"failed"===u.iceConnectionState&&u.restartIce()};let d=!1;const f="red"===a;let g=!1,h=!1;u.onnegotiationneeded=async()=>{try{d=!0,await u.setLocalDescription(),l.send("description",u.localDescription)}catch(n){}finally{d=!1}},u.ondatachannel=n=>{(null==t||f)&&i(n.channel,l)},l.onmessage=async function(n){const t=JSON.parse(n);var o;if(t.from!==s)if(e)r.server_message(t);else if("candidate"===t.action)!function(n,e){e.addIceCandidate(n).catch((n=>{}))}(t.data,u);else if("description"===t.action){const n=t.data,e=!d&&("stable"===u.signalingState||h),o="offer"===n.type&&!e;if(g=!f&&o,g)return;h="answer"===n.type,await u.setRemoteDescription(n),h=!1,"offer"===n.type&&(await u.setLocalDescription(),l.send("description",u.localDescription))}else"connected"===t.action?(o=l,i(u.createDataChannel("gamechannel"),o)):t.action}},sendMessage:function(n){return!!t&&(!!o&&(t.send(n),o))},on:function(n,e){r[n]=e},getOtherColor:a}}},969:(n,e,t)=>{function o(n,e){return function(n,e,t,o){return e||("https:"!==n?"ws://"+t+":"+o.wsPort:void 0)}(n.protocol,e.wh,n.hostname,e)}function c(n,e){return e.sh||n.origin}t.d(e,{B:()=>o,Y:()=>c})}}]);